cache:
  paths:
    - venv
test:
  script:
    - "echo running tests for $CI_BUILD_REF_NAME"
    - "echo installing npm and phantomJS via nvm"
    - "git clone https://github.com/creationix/nvm.git ~/.nvm && cd ~/.nvm && git checkout `git describe --abbrev=0 --tags`"
    - ". ~/.nvm/nvm.sh"
    - "nvm install 5.0"
    - "nvm use 5.0"
    - "npm install"
    - "npm run dev > /dev/null &"
    - "make -f tools/makefiles/multilang"
    - "echo installing python dependencies in virtual environment"
    - "[ ! -d venv ] && virtualenv -p python3 venv"
    - "source venv/bin/activate"
    - "pip3 install -r requirements.txt"
    - "cd src"
    - "python -m unittest"
